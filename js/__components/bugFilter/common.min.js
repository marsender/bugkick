function applyScrollPane(){sideBarMiddle.jScrollPane({hideFocus:true,animateScroll:true})}function setFilterHeight(){var e=sideBarMiddle.height();if(typeof localStorage!="undefined"){localStorage.setItem("filterHeight",e)}}function getFilterHeight(){if(typeof localStorage!="undefined"&&localStorage.getItem("filterHeight")>0&&localStorage.getItem("filterHeight")<=maxFilterHeight){return localStorage.getItem("filterHeight")}return defaultFilterHeight}function initResizable(){sideBarMiddle.resizable({minHeight:defaultFilterHeight,maxHeight:maxFilterHeight,autoHide:true,handles:"s",stop:function(e,t){applyScrollPane();setFilterHeight()}})}function updateLabels(){$.ajax({url:"/bugkick/label/updateCount",type:"post",data:{YII_CSRF_TOKEN:YII_CSRF_TOKEN},success:function(e,t,n){$.each(e.labels,function(e,t){$("#label_"+e).find(".label-count").html("("+t+")")})},error:function(e,t,n){alert("We are unable to update labels at this time.  Please try again in a few minutes.")},dataType:"json"})}$(document).ready(function(){function c(){$("#filterForm").ajaxSubmit({url:e+act,beforeSubmit:function(e){},success:function(e){$("#bug-list").html(e);renderTicketUsersAndLabels();addTooltip();destroySortable();setupSortable()},error:function(e){},dataType:"html"})}function h(e,t,n,r){$(e).droppable({greedy:true,tolerance:"pointer",hoverClass:"drophover",accept:"div.ticket-item",drop:function(e,i){var s=[];if(i.draggable.attr("id")=="bugkick-multidrag-container"){$(".ticket-item",i.draggable).each(function(){s.push($(this).attr("ticketID"))})}else{s.push(i.draggable.attr("ticketID"))}var o=$(this).attr(t),u={elemID:s,YII_CSRF_TOKEN:YII_CSRF_TOKEN};u[t]=o;$.ajax({url:n,type:"post",data:u,success:function(e,n,r){var i=$("input#bugSearch").serialize();$.fn.yiiListView.update("bug-list",{data:i});if(t=="labelID"){updateLabels()}},error:r});$("#bug-list div.items").data("disallowSort",true);if(typeof mixpanel!="undefined"){mixpanel.track(FILTER_APPLIED_BY_DRAG_N_DROP)}p()}})}function p(){$("li.Node").droppable("destroy");$("li.Node").droppable({greedy:false,tolerance:"pointer",accept:"div.ticket-item",over:function(e,t){$("li.Node.expanded").removeClass("expanded").find("ul").hide();if($(this).parent().attr("id")!="filterTree")$(this).addClass("expanded").find("ul").show()}})}function d(e){return function(t,n,r){alert(e)}}var e='/bugkick';$(".tree").simpleTreeMenu();var t=unescape(get).substring(1,get.length);var n=t.split("&");for(var r=0;r<n.length;r++){var i=n[r].match(/=(\d+)/i);var s=n[r].match(/[\w-]+/i);if(i!=null){var o=s[0]+"_"+i[1];if(s=="user"||s=="status"||s=="label"||s=="group"||s=="filter"){$("#"+s+"Tree").simpleTreeMenu("expandToNode",$("#target-"+s));$("#"+o).css("color","#3bd392");input=$("#"+o).next(":input");input.val(i[1]);var u=input.next(":input");u.val("")}if(s=="user-negative"||s=="status-negative"||s=="label-negative"||s=="group-negative"||s=="filter-negative"){s=s[0].substring(0,s[0].length-9);o=s+"_"+i[1];$("#"+s+"Tree").simpleTreeMenu("expandToNode",$("#target-"+s));$("#"+o).css("color","grey");input=$("#"+o).next(":input");input.val("");var u=input.next(":input");u.val(i[1])}}}var a=180,f=0,l=null;$(".operations a[class!='filter-edit-link']").click(function(){var e=$(this);f++;if(f===1){l=setTimeout(function(){var t=e.attr("id");var n,r,i;if(t=="saveFilter")return false;n=t.match(/\d+/i)[0];r=e.next(":input");i=r.next(":input");if(e.attr("class")=="saved-filters-link"){if(r.val()==""){$(".operations a").css("color","");$(".operations a").next(":input").val("");$(".operations a").next(":input.negative").val("")}}else{$(".saved-filters-link").css("color","");$(".saved-filters-input").val("");$(".saved-filters-input-negative").val("")}if(r.val()==""){e.css("color","#3bd392");r.val(n);i.val("")}else{e.css("color","");r.val("");i.val("")}c();f=0},a)}else{var t=e.attr("id");var n,r,i;if(t=="saveFilter")return false;n=t.match(/\d+/i)[0];r=e.next(":input");i=r.next(":input");if(e.attr("class")=="saved-filters-link"){if(i.val()==""){$(".operations a").css("color","");$(".operations a").next(":input").val("");$(".saved-filters-input-negative").val("")}}else{$(".saved-filters-link").css("color","");$(".saved-filters-input").val("");$(".saved-filters-input-negative").val("")}if(i.val()==""){e.css("color","grey");i.val(n);r.val("")}else{e.css("color","");i.val("");r.val("")}c();clearTimeout(l);f=0}return false}).live("dblclick",function(e){e.preventDefault()});var v=[{selector:"div.label-container",targetIdName:"labelID",requestUrl:e+"/bug/DndAddLabel",errorCallback:d("We are unable to set the label at this time.  Please try again in a few minutes.")},{selector:"li.user",targetIdName:"userID",requestUrl:e+"/bug/DndAddUser",errorCallback:d("We are unable to set the assignee at this time.  Please try again in a few minutes.")},{selector:"li.status",targetIdName:"statusID",requestUrl:e+"/bug/DndAddStatus",errorCallback:d("We are unable to change the status at this time.  Please try again in a few minutes.")}];for(r=0;r<v.length;r++)h(v[r].selector,v[r].targetIdName,v[r].requestUrl,v[r].errorCallback);p();if(typeof localStorage!="undefined"){if(localStorage.getItem("statusTree")==1){$("#statusTree").simpleTreeMenu("expandToNode",$("#target-status"))}if(localStorage.getItem("labelTree")==1){$("#labelTree").simpleTreeMenu("expandToNode",$("#target-label"))}if(localStorage.getItem("userTree")==1){$("#userTree").simpleTreeMenu("expandToNode",$("#target-user"))}if(localStorage.getItem("groupTree")==1){$("#groupTree").simpleTreeMenu("expandToNode",$("#target-group"))}if(localStorage.getItem("filterTree")==1){$("#filterTree").simpleTreeMenu("expandToNode",$("#target-filter"))}}$(".delete-filter").click(function(){var t=$(this).attr("id");if(t>0){if(confirm("Delete this filter?")){window.location=e+"/user/deleteFilter/id/"+t}}return false});sideBarMiddle.css({height:getFilterHeight()});applyScrollPane();initResizable()});var sideBarMiddle=$("#sidebar .sidebar_middle:first");var maxFilterHeight=$(window).height()-160;var defaultFilterHeight=220