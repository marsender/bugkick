function nearTrim(e,t,n){if(n===undefined)n="â€¦";if(t>=e.length)return e;return e.substr(0,t).replace(/\s+?(\S+)?$/,"").replace(/\s+$/,"")+n}function submitProjectForm(){$("#project-form").ajaxSubmit({success:function(e){$("#project-form-dialog").html(e.html);$("#project-form .chzn-select").chosen();if(e.success){if($("#projects-list").length!=0){$("#projects-list").yiiListView.update("projects-list")}if($("#projects-grid").length!=0){$("#projects-grid").yiiGridView.update("projects-grid")}$("#project-form-dialog").dialog("close");if($("#project-item-"+e.projectID).length!=0){$("#project-item-"+e.projectID).html("<li>"+'<a href="#" onclick="return switchToProject('+e.projectID+');" class="project-url">'+nearTrim(e.projectName,17)+"</a>"+"</li>")}else{$(".projects-container").prepend('<li class="project-item-'+e.projectID+'">'+'<a href="#" onclick="return switchToProject('+e.projectID+');" class="project-url">'+nearTrim(e.projectName,17)+"</a>"+"</li>")}if($("#view-project-link-"+e.projectID).length!=0){$("#view-project-link-"+e.projectID).text(nearTrim(e.projectName,20))}if($("div.steps").length!=0){window.location="/project/choose/?menu_project_id="+e.projectID+"&rr=new%2F2%3Fcompleted_step_1=1"}}},dataType:"json"});return false}function closeDialog(){$(this).dialog("close");return false}function editProject(targetObj){var windowWidth=$(window).width(),width=565,xoffset=eval(windowWidth/2-width/2);$.get(this.href,{YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(data){if(data.success){dlg=$("#project-form-dialog").html(data.html);$("#project-form").css("display","block");if(targetObj.currentTarget.attributes["class"].nodeValue=="update"){dlg.dialog({modal:true,dialogClass:"infobox",width:width,position:[xoffset,100],title:"Edit project"})}else{dlg.dialog({modal:true,dialogClass:"infobox",width:width,position:[xoffset,100],title:"New project"});$("#archived-row").hide()}$("#project-form .chzn-select",dlg).width(eval(width*.9));$("#project-form .chzn-select",dlg).chosen();dlg.dialog("open")}else if(!data.success&&data.limit=="1"){dlg=$("#update-dialog").html(data.html);dlg.dialog("open")}$(".ui-dialog-buttonset").attr("style","clear:both;")},"json").error(function(e,t,n){});return false}$(function(){function n(){$.getJSON(this.href,{action:"gantt",YII_CSRF_TOKEN:YII_CSRF_TOKEN},function(e){var n='<div id="overalProjectProgress"></div>					<div id="projectGanttDiagram" style="width:90%; height:400px; margin:0 auto;"></div>';t.html(n);var r=0;if(e.tasksCounts.total!=0)r=Math.round(e.tasksCounts.completed/(e.tasksCounts.total/100));t.find("#overalProjectProgress").fprogressBar({progress:r});var i={source:e.source,navigate:"scroll",scale:"days",minScale:"days",maxScale:"months",holydays:[]};t.find("#projectGanttDiagram").append('<div class="gantt"></div>').find(".gantt:first").gantt(i);t.dialog("option","title",e.project.name);t.dialog("open")}).error(function(e,t,n){});return false}var e=window.location.protocol+"//"+window.location.hostname;$("#projects-list a.update").live("click",editProject);$("#projects-grid a.update").live("click",editProject);$("#createProjectBtn, a#settings-tab").live("click",editProject);$("body").append('<div id="manageProjectDlg"></div>');var t=$("#manageProjectDlg").dialog({autoOpen:false,resizable:false,draggable:false,modal:true,width:850,height:450,beforeClose:function(e,n){t.html("")}});$(".manageProject").live("click",n)})